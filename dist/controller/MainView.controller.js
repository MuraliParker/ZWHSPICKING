sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,s){"use strict";return e.extend("com.sap.parker.zwmpicking.controller.MainView",{onInit:function(){this.oDataModel=this.getOwnerComponent().getModel();this.currentStep="";this.wareHouseNumber="";this.resourceGrp="";this.handlerNumber="";this.userloginId=this._getUserID();if(this.userloginId==="DEFAULT_USER"){this.userloginId=""}this.getView().byId("inpMat").setValue(this.userloginId);this.getView().byId("inpMat").fireChange();var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("RouteMainView").attachPatternMatched(this._onObjectMatched,this)},_getUserID:function(){if(sap.ushell){return sap.ushell.Container.getService("UserInfo").getId()}return""},_onObjectMatched:function(){this.userloginId=this._getUserID();if(this.userloginId==="DEFAULT_USER"){this.userloginId=""}this.getView().byId("inpMat").setValue(this.userloginId)},onMaterialHandlerChange:function(){var e=this;this.getView().setBusy(true);this.handlerNumber=this.getView().byId("inpMat").getValue();if(!this.handlerNumber){console.log("Handler Name Not Found : ",this.handlerNumber);e.getView().setBusy(false);return}this.getPrinterDetails(this.handlerNumber);this.oDataModel.read("/HandlerDetailSet('"+this.handlerNumber+"')",{success:function(t){console.log(t);e.getView().setBusy(false);e.getView().byId("inpCurrQ").setValue(t.Queue);e.wareHouseNumber=t.Lgnum;e.resourceGrp=t.Rsrcgrp;e.getView().byId("lblCurrQ").setVisible(true);e.getView().byId("inpCurrQ").setVisible(true);e.getView().byId("lblnewQ").setVisible(true);e.getView().byId("inpnewQ").setVisible(true);e.getView().byId("changeQbtn").setVisible(true);e.getView().byId("execbtn").setVisible(true);if(t.Lgnum=="1000"||t.Lgnum=="1002"){e.getView().byId("setPrinterbtn").setVisible(true);e.getView().byId("lblPrinter").setVisible(true);e.getView().byId("inpPrinter").setVisible(true)}else{e.getView().byId("setPrinterbtn").setVisible(false);e.getView().byId("lblPrinter").setVisible(false);e.getView().byId("inpPrinter").setVisible(false)}},error:function(t){console.log(t);sap.m.MessageToast.show("Material handler is not found");e.getView().setBusy(false);e.getView().byId("execbtn").setVisible(false)}})},getPrinterDetails:function(e){var t=this;this.oDataModel.read("/PrinterDetailSet('"+this.handlerNumber+"')",{success:function(e){console.log(e);t.getView().byId("inpPrinter").setValue(e.Spld)},error:function(e){console.log(e)}})},onExecutePress:function(){var e=this;var i=this.getView().byId("inpCurrQ").getValue();this.oDataModel.read("/ConfirmWarehouseTaskSet",{urlParameters:{$filter:"Lgnum eq '"+this.wareHouseNumber+"' and Queue eq '"+i+"' and Prsrc eq '"+this.handlerNumber+"'",$expand:"CWTtoSer"},success:function(i){console.log(i);if(i.results.length>0){var r=new t;r.setData(i.results[0]);e.itemData=i.results[0];e.getOwnerComponent().setModel(r,"WarehouseTaskModel");e.getOwnerComponent().getRouter().navTo("TaskView")}else{s.information("No WareHouse Task Found")}},error:function(e){s.error("Error while fetching Warehouse Task");console.log(e)}})},showNewQueueValueHelp:function(){var e=this;this._queueHelpDialog=null;this._queueHelpDialog=sap.ui.xmlfragment("com.sap.parker.zwmpicking.view.NewQueue",this);this.getView().addDependent(this._queueHelpDialog);this.oDataModel.read("/HandlerDetailSet",{urlParameters:{$filter:"Lgnum eq '"+this.wareHouseNumber+"' and Rsrcgrp eq '"+this.resourceGrp+"'"},success:function(s){console.log(s);var i=new t;i.setData({QueueModelSet:s.results});sap.ui.getCore().byId("idSearchNewQueue").setModel(i,"QueueModel");e._queueHelpDialog.open()},error:function(e){console.log(e)}})},showPrinterValueHelp:function(e){var s=this;this._valueHelpDialog=null;this._valueHelpDialog=sap.ui.xmlfragment("com.sap.parker.zwmpicking.view.printer",this);this.getView().addDependent(this._valueHelpDialog);this.oDataModel.read("/PrinterDetailSet",{urlParameters:{$filter:"Bname eq '"+this.handlerNumber+"'"},success:function(e){console.log(e);var i=new t;i.setData({PrinterModelSet:e.results});sap.ui.getCore().byId("idSearchPrinter").setModel(i,"PrinterModel");s._valueHelpDialog.open()},error:function(e){console.log(e)}})},handlePrinterSelClose:function(e){this.SelectedPrinter=e.getParameter("selectedItems")[0].getAggregation("cells")[0].getProperty("text");this.getView().byId("inpPrinter").setValue(this.SelectedPrinter);if(this._valueHelpDialog){this._valueHelpDialog.destroy(true);this._valueHelpDialog=null}},onPressOkButton:function(e){this.SelectedPrinter=sap.ui.getCore().byId("idSearchPrinter").getSelectedItem().getAggregation("cells")[0].getProperty("text");this.getView().byId("inpPrinter").setValue(this.SelectedPrinter);if(this._valueHelpDialog){this._valueHelpDialog.destroy(true);this._valueHelpDialog=null}},onPressCancelButton:function(e){if(this._valueHelpDialog){this._valueHelpDialog.destroy(true);this._valueHelpDialog=null}},onPressOkQueueButton:function(e){this.setQueue=sap.ui.getCore().byId("idSearchNewQueue").getSelectedItem().getAggregation("cells")[0].getProperty("text");this.getView().byId("inpnewQ").setValue(this.setQueue);if(this._queueHelpDialog){this._queueHelpDialog.destroy(true);this._queueHelpDialog=null}},onPressCancelQueueButton:function(e){if(this._queueHelpDialog){this._queueHelpDialog.destroy(true);this._queueHelpDialog=null}},onSetPrinter:function(){var e=this;this.getView().setBusy(true);this.requestBody={};this.requestBody.Bname=this.handlerNumber;this.requestBody.Spld=this.getView().byId("inpPrinter").getValue();this.oDataModel.update("/PrinterDetailSet('"+this.handlerNumber+"')",this.requestBody,{success:function(t,i){console.log("success");e.getView().setBusy(false);s.information("Printer has been Updated Successfully")},error:function(t){e.getView().setBusy(false);console.log("error");s.error(JSON.parse(t.responseText).error.message.value)}})},onChangeQueue:function(){this.getView().setBusy(true);var e=this;this.requestBody={};this.requestBody.Uname=this.handlerNumber;this.requestBody.Lgnum=this.wareHouseNumber;this.requestBody.Rsrc=this.handlerNumber;this.requestBody.Rsrcgrp=this.resourceGrp;this.requestBody.Seqno="";this.requestBody.Queue=this.getView().byId("inpnewQ").getValue();this.oDataModel.update("/HandlerDetailSet('"+this.handlerNumber+"')",this.requestBody,{success:function(t,i){e.getView().setBusy(false);console.log("success");e.getView().byId("inpCurrQ").setValue(e.getView().byId("inpnewQ").getValue());s.information("Queue has been Updated Successfully")},error:function(t){e.getView().setBusy(false);console.log("error");s.error(JSON.parse(t.responseText).error.message.value)}})}})});